# 基础镜像
FROM node:20-alpine

# 设置环境变量
ENV NODE_ENV=production \
    PORT=7860 \
    HOSTNAME="0.0.0.0"

# 创建非 root 用户 (Hugging Face 推荐)
RUN addgroup -S appgroup && adduser -S appuser -G appgroup

WORKDIR /app

# 复制构建产物 (由 CI 准备好)
COPY --chown=appuser:appgroup public ./public
COPY --chown=appuser:appgroup .next/static ./.next/static
# 复制 standalone 目录的内容到 /app
COPY --chown=appuser:appgroup standalone/ ./

# 切换用户
USER appuser

# 暴露端口
EXPOSE 7860

# 启动命令
CMD ["node", "server.js"]
