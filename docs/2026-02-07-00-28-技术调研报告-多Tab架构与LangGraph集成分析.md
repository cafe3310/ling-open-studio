# 2026-02-07-00-28-技术调研报告-多Tab架构与LangGraph集成分析

## 背景与目的

基于用户最新指示，本项目需要优先实现多 Tab 切换（Chat, Web, Write）并对接 LangGraph。本报告旨在总结对参考项目 `ling-model-judge` 的调研结果，并为接下来的实施提供技术依据。

## 调研来源
- 项目: `ling-model-judge`
- 关键文件:
    - `components/assistant-ui/assistant.tsx` (前端运行时配置)
    - `app/api/graph/[graphId]/route.ts` (后端 API 适配)

## 关键发现

### 1. LangGraph 后端集成模式
`ling-model-judge` 采用了一种“端到端流式适配”方案：
- **前端**: 使用 `AssistantChatTransport` 指向特定的 API 路由（如 `/api/graph/simple-llm-judge`）。
- **后端**: 
    - 使用 `toBaseMessages` 将 `assistant-ui` 发送的消息转换为 LangChain 格式。
    - 调用 `graph.stream` 获取流式输出（使用 `streamMode: ['messages']`）。
    - 使用 `toUIMessageStream` 和 `createUIMessageStreamResponse` 将 LangChain 流转换回 `assistant-ui` 可识别的 UI 消息流。
- **依赖需求**: 需要引入 `@ai-sdk/langchain` 处理格式转换。

### 2. 多 Tab 布局逻辑 (基于用户建议)
调研发现 `ling-model-judge` 使用了标准的 `SidebarProvider` + `Sidebar` 结构。但结合用户指示（参考 `reference` 中的设计），我们采用**顶部导航栏**方案：
- **顶部导航**: 包含 Logo, Tab 切换 (Chat, Web, Write, Design System), 用户头像。
- **内容区**: 占据剩余空间，根据 Tab 切换渲染不同组件。
    - Chat Tab: 消息列表 + 输入框 + 参数面板 (三栏或双栏)。
    - Web Tab: 暂留空 (Placeholder)。
    - Write Tab: 暂留空 (Placeholder)。

## 实施建议

### 第一步：引入必要依赖
安装 `@ai-sdk/langchain` 以支持 LangGraph 的消息流转换。

### 第二步：实现多 Tab 状态管理
在 `app/assistant.tsx` (或新建 `app/studio.tsx`) 中引入 `useState` 管理 `activeTab`。
```tsx
type Tab = 'chat' | 'web' | 'write';
const [activeTab, setActiveTab] = useState<Tab>('chat');
```

### 第三步：重构布局架构
1. **移除** 原有的 `Sidebar` 结构（如果与顶部导航冲突）。
2. 实现 `TopNavigation` 组件。
3. 修改主容器，使其包含 `TopNavigation` 和 `MainContent`。

### 第四步：LangGraph API 实现
在 `app/api/chat/route.ts` 中实现类似 `ling-model-judge` 的逻辑，对接实际的 LangGraph 后端。

## 后续建议
- 确认是否需要支持多 Thread 切换（即在每个 Tab 下都有独立的 Thread 列表）。
- 确认 LangGraph API 的具体后端地址和 ID。
