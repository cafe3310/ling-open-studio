# 2026-02-10-23-57-开发日志-ModelWeb流水线展示优化与国际化适配

## 1. 背景 (Background)

为了进一步优化 Model Web (网页生成助手) 的用户感知，我们对其展示逻辑进行了深度重构。目标是消除“块重复”现象，实现类似“流水线步骤”的清晰体验，并完成 UI 的国际化（全英文）适配。

## 2. 来源文档 (Source)
- [[2026-02-10-23-46-开发日志-优化ModelWeb流水线展示与预览交互体验]]

## 3. 主要工作 (Major Changes)

### 3.1 状态消息分片 (Status Message Protocol)
- **引入 `createStatusMessage`**：在后端 `initial-gen.ts` 中引入了辅助函数，用于产生 `name: "status"` 的 `AIMessageChunk`。
- **渲染逻辑分支**：
    - `WebMarkdownText` 现在能识别并专门渲染“状态分片”。
    - **精简模式**：状态分片只展示一个不可折叠的状态条（如 "Requirement planning completed"），不显示内容区，从而实现了“进度条”与“内容块”的解耦。

### 3.2 节点流水线 UI 升级
- **视觉风格对齐**：参考 `ling-model-judge` 的体验，重构了节点的展示样式。
    - **动态图标**：正在运行的节点显示旋转的 `Loader2`，已完成节点显示绿色勾选。
    - **自动展开**：活跃节点（`isRunning`）会自动展开详情区，生成结束后默认收起（支持用户手动点击 "View Details"）。
- **稳定 ID 机制**：为每个节点的消息赋予了固定的 ID 前缀（如 `web-gen-style-${taskId}`），彻底解决了在 LangGraph `messages` 模式下 UI 块重复渲染的问题。

### 3.3 交互与国际化
- **全英文适配**：将所有残留的中文字符（如“需求规划”、“代码实现”、“收起详情”等）统一翻译为地道的英文表达。
- **推荐示例优化**：
    - 修复了侧边栏（w-80）下由于 CSS 限制导致部分建议卡片被隐藏的 Bug。
    - 新增了 **"Personal Business Card"** 推荐示例。

## 4. 遇到的问题与修正 (Issues & Fixes)

- **无限重渲染 (Cached Snapshot)**：修复了 `useAuiState` 选择器返回新对象引发的 React 报错。
- **预览锚点失效**：通过向 `srcDoc` 注入 `patchScript` 拦截了 `#anchor` 跳转，改为 `scrollIntoView`。

## 5. 后续计划 (Next Steps)

- [ ] 开始 **Model Write** 助手的实现。
- [ ] 探索如何在 VFS 中实现多页面之间的平滑导航预览。
