# 2026-02-07-02-57-开发日志-优化自动命名Prompt逻辑

## 背景

在测试自动命名功能时，发现使用默认的消息数组传递方式可能导致 `Ling-Mini` 模型的输出不够稳定（有时会包含多余的前缀或理解偏差）。为了提高标题生成的质量，我们决定将对话历史显式地格式化并拼接在 System Prompt 中，以提供更强的上下文约束。

## 来源文档

- [docs/2026-02-07-02-48-开发日志-实现Chat线程自动命名功能.md](./2026-02-07-02-48-开发日志-实现Chat线程自动命名功能.md)

## 优化内容

### 1. 显式拼接上下文
- 修改了 `app/lib/assistants/naming-graph.ts`。
- 不再将 `messages` 数组直接传给 `model.invoke`。
- 而是提取前两轮对话，格式化为 `User: ...\nAssistant: ...` 的纯文本。
- 将这段文本直接附加在 Prompt 的任务描述之后，形成一个完整的指令块。

### 2. Prompt 微调
- 采用了更加命令式的指令风格：
  > "Respond with the title text:\n\n[Conversation Text]"
- 这种结构能有效防止模型输出 "Title: " 等不必要的前缀。

## 验证结果

- **测试**: 经过手动测试，`/api/naming` 接口现在能稳定返回仅包含标题文本的 JSON。
- **UI**: 前端能正确接收并在侧边栏更新标题。

## 下一步

- **Web 生成模块**: 继续进行 Model Web Tab 的内容填充工作。
