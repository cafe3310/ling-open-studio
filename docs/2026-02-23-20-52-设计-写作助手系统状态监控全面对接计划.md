# 2026-02-23-20-58-设计-写作助手系统状态监控全面对接计划

## 1. 背景 (Background)
为了提升用户体验，确保 System Monitor (`WriteStatusViewer`) 能够真实、实时地反映 Model Write 背后所有智能体 Graph 的运行状态，并提供极具辨识度的视觉反馈。

## 2. 来源文档 (Source)
- [[2026-02-22-22-10-设计-ModelWrite写作助手功能与UI全量梳理.md]]
- [[2026-02-22-22-12-设计-ModelWrite智能体架构与Graph流程全量梳理.md]]

## 3. 目标 (Objective)
建立透明的后台运行状态反馈体系。

## 4. 状态映射与视觉规范 (Visual Specs)

| 状态 | 颜色 (Tailwind) | 图标 (Lucide) | 行为 |
| :--- | :--- | :--- | :--- |
| **Idle** | `text-slate-300` | `Clock` | 静态，代表资源就绪。 |
| **Running** | `text-amber-500` | `CircleDashed` | 旋转动画，实时显示进度 (Tokens)。 |
| **Success** | `text-emerald-500` | `CheckCircle2` | 静态，代表任务圆满完成。 |
| **Error** | `text-rose-500` | `AlertCircle` | 静态，提示需要关注或重试。 |

## 5. 对接实施逻辑 (Logic Integration)

### 5.1 段落处理流 (WriteCanvas.tsx)
在 `triggerPreprocessing` 过程中：
*   **Start**: 
    *   `SegmentPreprocessor` -> `running`
    *   `LoreKeeper` -> `running`
    *   `MuseWhisper` -> `running`
*   **End**: 
    *   全部更新为 `success` (或 `error`)。
    *   `SegmentPreprocessor.lastResult` = 摘要文本。

### 5.2 预测流 (WriteCanvas.tsx)
在 `triggerPrediction` 过程中：
*   **Start**: `PhantomWeaver` -> `running`
*   **End**: `PhantomWeaver` -> `success` + `lastResult` (预测文本)。

### 5.3 创作流 (WriterActions.tsx)
*   **NarrativeFlow**: 确保 `lastResult` 截取生成的前 20 个字符作为预览。
*   **ContentRewriter**: 同上。

## 6. 验证 (Verification)
1. 输入文字，观察 `SegmentPreprocessor` 是否立即进入 Running。
2. 停顿 500ms，观察 `PhantomWeaver` 是否闪烁。
3. 点击 Continue，观察 `NarrativeFlow` 的 Token 计数是否随着流式输出而跳动。
