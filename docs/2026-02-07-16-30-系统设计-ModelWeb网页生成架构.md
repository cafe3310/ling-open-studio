# 设计 - Model Web 网页生成全流程架构 v2

## 1. 概述 (Overview)
`Model Web` 旨在展示模型从自然语言到交互式前端页面的完整转化能力。它不仅是简单的代码生成，而是一个**端到端的 Web 工程协作体验**。基于 VFS（虚拟文件系统），Agent 将在指定目录下构建完整的网页应用，并支持实时预览与迭代。

## 2. 三栏布局设计 (Three-Pane Layout)

采用与 `WebPage.tsx` 原型一致的 **InclusionAI 学术风格**，三栏布局如下：

### 2.1 左侧：指令与协作区 (Sidebar Left - 320px)
*   **功能**: 接收用户指令，展示 Agent 的生成过程，管理生成历史。
*   **Header**: `Generator` 标题。
*   **Chat Area**: 
    *   **User Message**: 带有 "User" 标签的灰色卡片。
    *   **Model Message**: 带有 "Model" 标签的白色卡片，支持 Markdown 和代码片段的高亮显示。
    *   **Status Indicators**: 当 Agent 处于 Analyst/Designer/Coder 阶段时，显示加载动画或中间产物（如 `<Header />`, `<Hero />` 等结构占位符）。
*   **Input Area** (Fixed Bottom):
    *   `TextArea`: "Describe the UI you want to build..."。
    *   `Generate Button`: 带有 Loading 状态 (`Coding...`) 和 Icon (`Play/RefreshCw`)。

### 2.2 中间：实时预览舞台 (Main Content)
*   **背景**: `bg-brand-bg` (浅灰)，营造工作台氛围。
*   **Toolbar (浮动置顶)**:
    *   **View Mode Switcher**: Desktop (`Monitor`) / Mobile (`Smartphone`) 切换按钮。
    *   **Address Bar**: 模拟浏览器地址栏，显示 `vfs://...` 路径。
*   **Preview Container**:
    *   **Iframe**: 承载生成的 HTML。
    *   **Transitions**: 切换 Mobile/Desktop 时的平滑尺寸过渡动画。
    *   **Loading Overlay**: 生成过程中显示的磨砂玻璃效果 (`backdrop-blur-sm`) 和优雅的 Loading 文案 ("Refining pixels...")。

### 2.3 右侧：配置与风格 (Sidebar Right - 288px)
*   **Header**: `Styles` (带 `LayoutTemplate` 图标)。
*   **Config Sections**:
    *   **Design Aesthetic**: 网格布局的风格选择按钮 (Minimal, Modern, Brutalist, Warm)。选中态高亮 (`border-brand-cyan`).
    *   **Tech Stack**: 下拉菜单选择技术栈 (HTML+Tailwind, React+Shadcn)。
    *   **Advanced**: Checkbox 列表 (Dark Mode, Animations)。

## 3. 核心 Workflow (LangGraph 节点细节)

Graph 采用经典的瀑布流变体，支持后续的对话式迭代。

### 3.1 状态定义 (State)
```typescript
interface WebGenState {
  messages: BaseMessage[];
  taskId: string;          // 本次生成的目录 ID
  requirements: string;    // 详细化的需求文档
  design_spec: string;     // 视觉设计规范 (配色、字体、布局)
  file_paths: string[];    // 生成的文件列表
  iteration: number;       // 当前迭代轮次
}
```

### 3.2 节点流转 (Nodes)

1.  **Node: Analyst (需求详细化)**
    *   **Prompt 策略**: 将用户的一句话需求扩展为结构化的功能列表。
    *   **示例**: 用户说“做一个咖啡店首页” -> Analyst 补充“包含菜单导航、店面大图、营业时间、地址地图等”。

2.  **Node: Designer (视觉设计)**
    *   **职责**: 输出一个 JSON 格式的 Style Spec。
    *   **内容**: `primary_color`, `font_family`, `border_radius` 等。

3.  **Node: Architect (文件规划)**
    *   **职责**: 在 VFS 中创建项目目录，并规划文件列表（如 `index.html`, `main.js`）。

4.  **Node: Coder (逐步编码)**
    *   **工具调用**: 循环调用 `writeFile` 将代码写入 VFS。
    *   **逻辑**: Coder 会参考 Designer 输出的 Style Spec 来编写 Tailwind 类名。
    *   **技术栈**: **HTML5 + Vanilla JS + Tailwind CSS (CDN)** (Phase 1)。

5.  **Node: Self-Corrector (自我订正)**
    *   **职责**: 检查代码语法。针对 HTML/JS 的常见闭合问题进行简单修复。

## 4. VFS 交互协议

网页生成将严格操作以下路径：
- **项目根目录**: `/workspace/webapp/<uuid>/`
- **默认入口**: `/workspace/webapp/<uuid>/index.html`

**数据流向**:
`Agent (Coder)` -> `vfs.writeFile` -> `VFS (IndexedDB)` -> `UI (useVFS Subscription)` -> `Preview Component (Iframe Update)`

## 5. UI 组件开发计划

1.  **Step 1: 移植布局组件**: 将 `docs/reference/.../WebPage.tsx` 中的布局逻辑移植到 `app/components/web/` 下，拆分为 `WebChatSidebar`, `WebPreviewStage`, `WebConfigSidebar`。
2.  **Step 2: 集成 VFS**: 修改 Preview 组件，使其通过 `useVFS` 监听指定 `<uuid>` 目录下的 `index.html`，并将其内容注入 iframe。
3.  **Step 3: 对接 Graph**: 在左侧 Sidebar 集成 `AssistantRuntime`，但使用专门的 `WebGenGraph`。