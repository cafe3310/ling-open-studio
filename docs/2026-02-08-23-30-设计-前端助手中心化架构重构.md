# 2026-02-09-00-21-设计-前端助手中心化架构重构

## 1. 背景 (Background)

当前 `StudioShell` 承担了过多的职责：它同时管理 `Chat` 和 `Web` 两个不同的 `AssistantRuntime`，并且需要根据当前 Tab 手动处理不同的 `Thread` 属性（如 `forcedParadigm`, `silent`）。

随着 Web 生成内容的增长，单体架构导致了：
1. **性能压力**：长文本生成时，全局状态更新频繁。
2. **逻辑耦合**：通用的 `Thread` 组件被迫增加大量条件判断属性。
3. **维护困难**：前端架构与后端 `assistantRegistry` 的分层模式不匹配。

## 2. 目标架构 (Target Architecture)

我们将采用“垂直切分”模式，将每个助手的 Runtime 定义、UI 配置和专用组件封装在各自的目录中。

### 目录结构

```text
src/components/assistants/
├── general-chat/
│   ├── index.tsx           # 主入口 (GeneralChatAssistant)
│   ├── chat-runtime.ts     # Runtime 钩子封装
│   └── chat-view.tsx       # 专用 UI 布局
└── web-architect/
    ├── index.tsx           # 主入口 (WebArchitectAssistant)
    ├── web-runtime.ts      # Runtime 钩子封装 (锁定 text 协议)
    ├── web-view.tsx        # 专用 UI (包含 Chat + Preview + Config)
    └── components/         # Web 专用的小型组件
```

## 3. 关键变更 (Key Changes)

### 3.1 StudioShell 的职责简化
`StudioShell` 将不再管理多个 `useChatRuntime`。它只负责维护 `activeTab` 状态，并渲染对应的助手根组件。

```tsx
// StudioShell 简化示意
return (
  <main>
    {activeTab === 'chat' && <GeneralChatAssistant />}
    {activeTab === 'web' && <WebArchitectAssistant />}
  </main>
)
```

### 3.2 助手根组件 (Assistant Component)
每个助手根组件内部维护自己的 `AssistantRuntime`，这保证了：
- **独立的上下文**：不同助手的生成互不干扰。
- **配置锁定**：`WebArchitectAssistant` 内部可以硬编码其协议和 UI 行为，无需透传 Props。

### 3.3 专用 Thread 配置
`GeneralChatAssistant` 使用标准的 `Thread`。
`WebArchitectAssistant` 使用预设了 `silent={true}` 和 `forcedParadigm="text"` 的专用配置，且可以根据性能需求定制消息渲染频率。

## 4. 实施计划 (Implementation Plan)

1. **创建新目录结构**：在 `src/components/assistants` 下建立 `general-chat` 和 `web-architect`。
2. **迁移 Chat 逻辑**：将 `StudioShell` 中关于 `chatRuntime` 的定义和 Sidebar 布局移至 `general-chat`。
3. **迁移 Web 逻辑**：将 `webRuntime` 和 `WebTab` 整合进 `web-architect`。
4. **清理通用组件**：移除 `Thread` 组件中不必要的条件分支，改由上层助手组件通过 context 或特定的 component 注入来处理。

## 5. 预期收益 (Benefits)

- **性能隔离**：Web 生成的长文本压力被限制在 `WebArchitectAssistant` 内部，不会影响全局 Shell 的响应速度。
- **高内聚**：助手的后端协议、前端解析和 UI 表现逻辑在物理目录上达到统一。
- **可扩展性**：未来增加 `Model Write` 助手时，只需在该目录下新建一个子目录即可。
