# 2026-02-07-01-01-开发日志-多Tab架构与LangGraph深度集成

## 背景与目标

本阶段的目标是实现应用的基础架构重构，使其从单一聊天界面转变为支持多模块（Chat, Web, Write）的集成展示平台。同时，需要在应用内部深度集成 LangGraph 引擎，并应用全新的 "Open Intelligence" (InclusionAI) 视觉风格。

## 实现了哪些功能点

1.  **多 Tab 架构实现**:
    -   实现了顶部导航栏 (`TopNavigation`)，支持 `Model Chat`, `Model Web`, `Model Write` 三个模块的无缝切换。
    -   采用了 `useState` 进行全局状态管理，根据当前选中的 Tab 动态渲染内容区域。
2.  **LangGraph 内部集成**:
    -   放弃了通过远端 SDK 调用，改为在应用内部直接定义和运行 Graph。
    -   创建了 `app/lib/assistants/simple-graph.ts` 作为首个基础推理图。
    -   实现了 `app/api/chat/route.ts` 路由，通过 `@ai-sdk/langchain` 的适配器将 LangGraph 的原生流转换为 UI 友好的流式响应。
3.  **兼容 OpenAI 的推理 API 对接**:
    -   参考 `ling-model-judge` 建立了统一的模型管理层 `app/lib/model.ts`。
    -   支持通过 `OPENAI_API_BASE` 对接国产大模型或内部代理服务。
4.  **视觉系统深度集成**:
    -   在 Tailwind 4 体系下应用了 InclusionAI 设计语言。
    -   集成了 `Playfair Display` (标题), `Inter` (正文), `JetBrains Mono` (代码) 三套字体。
    -   定义了 Ice Gray (#F8F9FB) 为主色调，辅以青色和蓝色的渐变高亮。

## 对代码/项目结构的主要修改

-   **`app/assistant.tsx`**: 从单一界面重构为包含导航和 Tab 切换的主入口。
-   **`app/api/chat/route.ts`**: 重写为直接对接本地 LangGraph 逻辑。
-   **`app/lib/model.ts`**: 新增文件，集中管理推理模型配置。
-   **`app/lib/assistants/`**: 新增目录，用于存放本地 Graph 定义。
-   **`components/top-navigation.tsx`**: 新增组件，实现了基于参考图设计的顶部导航栏。
-   **`app/globals.css` & `app/layout.tsx`**: 全面更新以支持新的视觉系统。

## 遇到的问题与修正

-   **推理输出空白**: 最初发现 `callModel` 节点运行正常但 UI 无显示。通过对比 `model-judger` 发现，必须为每个产生的消息分配唯一的 `id`（引入了 `uuid`），并使用 `AIMessageChunk` 包装，才能正确触发前端的流式解析。
-   **流式转换兼容性**: 修正了 `streamMode` 的配置，并确保 `toUIMessageStream` 接收到的是正确的事件流。

## 后续步骤建议

1.  **填充 Model Web 模块**: 目前为占位符，下一步应迁移 `osw-studio` 的代码生成与预览逻辑。
2.  **填充 Model Write 模块**: 引入编辑器和异步实体提取任务。
3.  **多线程持久化**: 目前每次刷新会生成新的 Session ID，后续需要引入数据库或本地存储来保持对话历史。
