# 2026-02-22-22-29-开发日志-ModelWrite重构备份与全套设计梳理

## 1. 背景 (Background)

在正式启动 "Model Write" 核心功能开发（将 Mock 替换为真实 LangGraph 逻辑）之前，我们需要确保：
1.  **资产保护**: 将现有的、已调优的 UI 视觉原型进行物理隔离。
2.  **设计对齐**: 基于现有 UI 源代码进行深度反向工程，建立准确的 State 结构和 Graph 流程定义。
3.  **逻辑增补**: 在评审过程中细化片段提取、推理阻塞和调试器功能。

## 2. 来源文档 (Source)
- [[2026-02-14-23-10-开发日志-完成ModelWrite交互架构与双栏布局]]
- [[2026-02-22-22-10-设计-ModelWrite写作助手功能与UI全量梳理]]
- [[2026-02-22-22-11-设计-ModelWrite写作助手State全量梳理]]
- [[2026-02-22-22-12-设计-ModelWrite智能体架构与Graph流程全量梳理]]
- [[2026-02-22-22-28-逻辑增补-ModelWrite功能与交互细化]]

## 3. 主要工作 (Major Changes)

### 3.1 物理重构与备份 (Ref Refactoring)
*   **目录重命名**: 
    *   `src/assistants/write-architect` -> `.../write-architect-ref` (服务端)
    *   `src/components/assistants/write-architect` -> `.../write-architect-ref` (客户端)
*   **引用调整**: 更新了 `studio-shell.tsx` 和 `registry.ts`，确保 `write-gen` 模式当前指向备份目录，UI 渲染保持正常，为新开发腾出命名空间。

### 3.2 全量设计文档体系建立
*   **功能与 UI 梳理**: 基于 `write-architect-ref` 源码，精确还原了三栏布局、`EntryDialog` 缝合逻辑、`Ghost Text` 交互及 `Segment` 三色状态。
*   **State 全量建模**: 规范化了 `WriteSessionState`、`TextSegment` 和 `KnowledgeEntry` 的数据结构，明确了持久化字段与运行时字段。
*   **Graph 流程与模型对齐**:
    *   定义了 5 个核心 Reasoning Graphs (Weaver, Preprocessor, Flow, Keeper, Whisper)。
    *   **模型选型**: 严格参照 `lib/model.ts`，将 `Ling_Flash` 分配给极速预测，`Ling_2_5_1T` 分配给高质量叙事，`Ring_1T` 分配给后台一致性维护。

### 3.3 核心逻辑增补 (Logic Add-ons)
*   **片段提取**: 确立了以“自然段（换行）”为单位的提取逻辑与状态回溯机制。
*   **多层级阻塞**: 为各模块定义了独立的 `isProcessing` 状态和对应的琥珀色/蓝色渐变边框 UI 反馈。
*   **调试器进化**: 确立了 `Global Log Viewer` 方案，支持查看原始推理请求、角色权重及思考过程。

## 4. 后续计划 (Next Steps)
- [ ] 提交当前重构与文档。
- [ ] 创建全新的 `write-architect` 目录并建立 Zustand Store（基于 State 全量梳理文档）。
- [ ] 开始集成编辑器内核并实现 `SegmentPreprocessor`。
