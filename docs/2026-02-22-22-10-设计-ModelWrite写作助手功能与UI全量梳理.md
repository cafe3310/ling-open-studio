# 2026-02-22-22-10-设计-ModelWrite写作助手功能与UI全量梳理

## 1. 总体视觉与交互风格 (Design Philosophy)
*   **沉浸感 (Immersion)**: 
    *   **背景**: 采用 `Ice Gray (#F8F9FB)` 侧边栏与纯白画布。
    *   **字体**: 标题/正文混合使用 `Playfair Display` (衬线) 增强文学感，辅助 UI 使用 `Inter` (无衬线)，编辑器内核使用 `JetBrains Mono` (等宽) 确保精准排版。
*   **透明协作 (Transparent Collaboration)**: 强调 AI 并非“代写”，而是“共创”。通过视觉状态标记（黑/黄/蓝）展示 AI 的后台工作。
*   **代码引用**: `src/components/assistants/write-architect-ref/index.tsx` 定义了全局布局。

## 2. 三栏式隔离布局 (Three-Pane Layout)

### 2.1 左侧：基石栏 (Lore Sidebar - Foundation)
*   **代码引用**: `src/components/assistants/write-architect-ref/write-left-sidebar.tsx`
*   **简介区**: 显示书名（Playfair Display Italic）及“Powered by Ling Series Models”说明。
*   **Summary (大纲预览)**:
    *   **UI**: 具备 `hover:shadow-md` 的卡片预览，显示 Summary 文本（italic, line-clamp-4）。
    *   **交互**: 点击触发 `Dialog`。内置 `Textarea` (font-mono)，提供 `Update Context` 按钮。
*   **Knowledge Base (知识库统一条目管理)**:
    *   **分类**: World Settings, Key Concepts, Characters。
    *   **条目组件 (`EntryDialog`)**: 
        *   **视觉状态**: Manual (实色边框) 与 Auto-detected (浅蓝背景 + 虚线边框 + Sparkles 图标)。
        *   **二段式转正**: `EntryDialog` 内部维护 `isAuto` 状态。点击 `Approve Entry` 按钮可将 AI 识别条目转正为正式条目。
        *   **建议缝合 (`addSuggestion`)**: 右侧展示 AI 建议碎片卡片，点击碎片会自动将文本以 `[现有内容] + [建议内容].` 的形式追加到左侧编辑器。
*   **角色条目 (`CharacterItem`)**: 
    *   具备呼吸灯状态点：Manual 条目显示 `bg-brand-blue` 阴影点，Auto 条目显示淡灰色。

### 2.2 中间：协作画布 (Main Canvas - Collaboration)
*   **代码引用**: `src/components/assistants/write-architect-ref/write-canvas.tsx`
*   **布局比例**: `grid-cols-[1fr_280px]`，即 70% 写作区与 30% 概要边栏。
*   **编辑器内核**: 基于 `contentEditable` 的片段化 (`Segment[]`) 列表。
*   **视觉状态语言 (`segment.status`)**:
    *   **Raw (书写中)**: `text-brand-dark`。末尾显示蓝色闪烁光标 (`animate-pulse`)。
    *   **Processing (处理中)**: `text-amber-600/50`。
    *   **Completed (已完成)**: `text-indigo-900/70`。
*   **行内补全 (Ghost Text)**:
    *   **交互实现**: 当状态为 `raw` 时，在段落末尾渲染 `text-brand-dark/20` 的占位文本。
*   **Insight Margin (右侧概要栏)**:
    *   **Summary**: 标题 `text-brand-dark/20`，内容 `text-brand-dark/40 italic font-sans`。
    *   **Entity Pills**: 采用 `indigo-50` 背景的微型 Badge，展示检测到的关键词。
    *   **实时反馈**: 处理中段落显示 `Analyzing...` 动画（bounce 效果）。
*   **顶部状态栏**: 固定在右上方，显示 `Preprocessing...` 琥珀色呼吸灯。

### 2.3 右侧：灵感与动作栏 (Intelligence Sidebar)
*   **代码引用**: `src/components/assistants/write-architect-ref/write-right-sidebar.tsx`
*   **主动动作区 (Writer Actions)**:
    *   **Continue Writing**: 主行动按钮，带 `Sparkles` 图标及阴影效果。
    *   **局部工具**: Rewrite (重写)、Expand (扩写)。
    *   **交互限制**: 底部提示“Select text on canvas for context-aware actions”。
*   **灵感卡片流 (`InspirationCard`)**:
    *   **分类**: Plot, Atmosphere, Dialogue。
    *   **Active 生命周期**: 
        *   点击切换 `isActive`。
        *   激活态：`bg-brand-blue/[0.04]` 背景 + 蓝边框 + 右上角 `Zap` 图标。
        *   标签：底部显示 `GUIDING GENERATION` Badge。
    *   **全局提示**: 当有任一卡片激活时，标题旁显示 `Active` 绿色呼吸灯标签。

### 2.4 系统调试器 (WriteStatusViewer)
*   **代码引用**: `src/components/assistants/write-architect-ref/write-status-viewer.tsx`
*   **位置**: 左下角固定定位。支持展开/收起切换（`Terminal` 图标）。
*   **Components 监控**: 监控 VFS、Editor Kernel、Context Engine 的健康度。
*   **Reasoning Graphs 监控**:
    *   展示 5 个 Graph (PhantomWeaver, SegmentPreprocessor, NarrativeFlow, LoreKeeper, MuseWhisper) 的运行状态 (idle/running/success/error)。
    *   **进度计数**: `running` 状态下显示 `50+`, `100+` 等由 `progress / 50` 计算出的 Token 进度值。
    *   **实时预览**: 展示 `lastResult` 的文本片段（font-mono, line-clamp-2）。
