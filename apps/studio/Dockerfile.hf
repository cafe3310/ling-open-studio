# 基础镜像
FROM node:20-alpine

# 设置环境变量
ENV NODE_ENV=production \
    PORT=7860 \
    HOSTNAME="0.0.0.0"

# 创建非 root 用户
RUN addgroup -S appgroup && adduser -S appuser -G appgroup

WORKDIR /app

# 复制整个由 GitHub Actions 组装好的目录结构
# 包含 apps/studio/server.js, apps/studio/public, apps/studio/.next/static 以及 node_modules
COPY --chown=appuser:appgroup . ./

# 切换用户
USER appuser

# 暴露端口
EXPOSE 7860

# 启动命令 - 指向子包内的 server.js
CMD ["node", "apps/studio/server.js"]